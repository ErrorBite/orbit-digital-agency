\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{shapes, arrows.meta, positioning, shadows, backgrounds, fit, calc}
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}
\usepackage{listings}
\usepackage{hyperref}

% Color Palette
\definecolor{orbitBlue}{RGB}{20, 30, 70}
\definecolor{orbitGold}{RGB}{255, 179, 0}
\definecolor{orbitLightBlue}{RGB}{220, 230, 255}
\definecolor{orbitAccent}{RGB}{50, 150, 250}
\definecolor{codeBg}{RGB}{245, 245, 245}

% Architectural Styles
\tikzstyle{block} = [rectangle, draw=none, fill=orbitAccent!20, text=orbitBlue, text width=6em, text centered, rounded corners, minimum height=3em, drop shadow]
\tikzstyle{database} = [cylinder, cylinder uses custom fill, cylinder body fill=orbitGold!20, cylinder end fill=orbitGold!40, shape border rotate=90, aspect=0.25, draw=orbitGold, thick, text=black, minimum width=2cm, minimum height=1.5cm, drop shadow]
\tikzstyle{cloud} = [draw=orbitBlue, thick, ellipse, fill=orbitLightBlue, node distance=3cm, minimum height=2em, drop shadow]
\tikzstyle{decision} = [diamond, draw=orbitAccent, fill=white, text width=4.5em, text centered, inner sep=0pt]
\tikzstyle{line} = [draw, -latex', thick, orbitBlue]

\title{\textbf{\Huge \color{orbitBlue} Orbit Digital Agency \\ System Architecture}}
\author{\large Generated by Antigravity}
\date{\today}

\begin{document}

\maketitle

\section{\color{orbitBlue} 1. System Overview}

The \textbf{Orbit Digital Agency} system is a modern web application built with \textbf{Next.js 14}, using \textbf{TypeScript} for type safety, \textbf{Tailwind CSS} for styling, and \textbf{MongoDB} (via Mongoose) for data persistence.

\vspace{0.5cm}

\begin{tcolorbox}[colback=orbitLightBlue, colframe=orbitBlue, title=\textbf{Core Technologies}]
\begin{itemize}
    \item \textbf{Frontend Framework}: Next.js 14 (App Router)
    \item \textbf{Database}: MongoDB Atlas
    \item \textbf{ORM}: Mongoose
    \item \textbf{Validation}: Zod
    \item \textbf{Styling}: Tailwind CSS + Framer Motion
\end{itemize}
\end{tcolorbox}

\section{\color{orbitBlue} 2. Database Structure \& Queries}

The database consists of three primary collections. Below is the visualization of the data models and their interactions.

\vspace{0.5cm}

\begin{center}
\begin{tikzpicture}[node distance = 2cm, auto]
    % Nodes
    \node [database] (db) {MongoDB};
    \node [block, above left=1cm and 2cm of db, fill=red!10, text=red!80!black] (user) {Inquiry \\ Schema};
    \node [block, above=2cm of db, fill=green!10, text=green!80!black] (project) {Project \\ Schema};
    \node [block, above right=1cm and 2cm of db, fill=purple!10, text=purple!80!black] (service) {Service \\ Schema};

    % Edges
    \path [line, dashed] (user) -- node [midway, left, font=\scriptsize] {Writes} (db);
    \path [line, dashed] (project) -- node [midway, font=\scriptsize] {Reads} (db);
    \path [line, dashed] (service) -- node [midway, right, font=\scriptsize] {Reads} (db);
\end{tikzpicture}
\end{center}

\subsection{\color{orbitAccent} 2.1 Mongoose Models}

\begin{enumerate}
    \item \textbf{\color{purple} Project Model} (\texttt{models/Project.ts}): Represents portfolio items.
    \begin{itemize}
        \item \textbf{Query}: \texttt{Project.find(\{\}).sort(\{ featured: -1, createdAt: -1 \})}
        \item \textit{Purpose}: Fetches all projects, prioritizing featured ones and newest additions.
    \end{itemize}
    
    \item \textbf{\color{purple} Service Model} (\texttt{models/Service.ts}): Represents services offered.
    \begin{itemize}
        \item \textbf{Query}: \texttt{Service.find(\{\})}
        \item \textit{Purpose}: Fetches the catalog of services to display on the landing page.
    \end{itemize}

    \item \textbf{\color{purple} Inquiry Model} (\texttt{models/Inquiry.ts}): Represents contact form submissions.
    \begin{itemize}
        \item \textbf{Query}: \texttt{Inquiry.create(\{ name, email, ... \})}
        \item \textit{Purpose}: Inserts a new document when a user submits the contact form.
    \end{itemize}
\end{enumerate}

\section{\color{orbitBlue} 3. Module \& Component Architecture}

The application follows the Next.js App Router structure.

\vspace{0.5cm}

\begin{center}
\begin{tikzpicture}[node distance = 1.5cm, auto]
    % Nodes
    \node [cloud] (client) {Client Browser};
    \node [block, below=1cm of client, text width=10em] (page) {\textbf{app/page.tsx} \\ (Server Component)};
    \node [block, below left=1.5cm of page, fill=yellow!20] (comps) {Components \\ (UI)};
    \node [block, below right=1.5cm of page, fill=blue!10] (dbLib) {lib/db.ts \\ (Connection)};
    \node [database, below=1.5cm of dbLib] (mongo) {Database};

    % Edges
    \path [line] (client) -- (page);
    \path [line] (page) -- node [left, font=\tiny] {Imports} (comps);
    \path [line] (page) -- node [right, font=\tiny] {Calls connectDB()} (dbLib);
    \path [line] (dbLib) -- (mongo);
    
    % Grouping
    \node [draw=black!20, fit=(page) (comps) (dbLib), rounded corners, dashed, label=above:\textcolor{gray}{Server Side}] {};

\end{tikzpicture}
\end{center}

\subsection{\color{orbitAccent} 3.1 Key Modules}

\begin{description}
    \item[\textbf{lib/db.ts}] This is a \textit{Singleton Module}. It ensures that the application maintains a single cached database connection across hot-reloads and serverless invocations. It exports the \texttt{connectDB} function.
    
    \item[\textbf{app/api/contact/route.ts}] This API Route acts as a controller.
    \begin{itemize}
        \item \textit{Input}: POST request with JSON body.
        \item \textit{Process}: Validates data using \textbf{Zod} $\rightarrow$ Connects to DB $\rightarrow$ Saves Inquiry.
        \item \textit{Output}: JSON success/error message.
    \end{itemize}
\end{description}

\section{\color{orbitBlue} 4. Workflow Diagrams}

\subsection{\color{orbitAccent} 4.1 Page Load / Data Fetching Flow}

When a user visits the homepage, the server performs an optimized fetch.

\begin{center}
\begin{tikzpicture}[node distance = 2cm, auto]
    % Nodes
    \node [block] (start) {Start Request};
    \node [decision, below=of start] (check) {DB Success?};
    \node [block, right=3cm of check, fill=red!20] (mock) {Use Mock Data};
    \node [block, below=of check, fill=green!20] (real) {Fetch Real Data};
    \node [block, below=of real] (render) {Render UI};

    % Edges
    \path [line] (start) -- (check);
    \path [line] (check) -- node [near start] {No} (mock);
    \path [line] (check) -- node [near start] {Yes} (real);
    \path [line] (mock) |- (render);
    \path [line] (real) -- (render);
\end{tikzpicture}
\end{center}

\subsection{\color{orbitAccent} 4.2 Contact Form Submission Flow}

\begin{center}
\begin{tikzpicture}[node distance = 2cm, auto]
    \node [block, fill=orange!20] (input) {User Input};
    \node [block, below=of input] (validate) {Zod Validation};
    \node [decision, below=of validate] (valid) {Valid?};
    \node [block, left=of valid, fill=red!20] (error) {Return 400};
    \node [block, below=of valid, fill=blue!10] (save) {Save to DB};
    \node [block, below=of save, fill=green!20] (success) {Return 200 OK};

    \path [line] (input) -- (validate);
    \path [line] (validate) -- (valid);
    \path [line] (valid) -- node [above] {No} (error);
    \path [line] (valid) -- node [right] {Yes} (save);
    \path [line] (save) -- (success);
\end{tikzpicture}
\end{center}

\end{document}
